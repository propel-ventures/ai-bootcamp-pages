---
import { getCollection, render } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import ResourceLink from '../../components/ResourceLink.astro';
import ObjectivesList from '../../components/ObjectivesList.astro';
import Quiz from '../../components/Quiz';

export async function getStaticPaths() {
  const modules = await getCollection('modules', ({ data }) => data.course === 2);
  return modules.map((module) => ({
    params: { slug: module.slug.replace('course-2/', '') },
    props: { module },
  }));
}

const { module } = Astro.props;
const { Content } = await render(module);
const { title, description, objectives, resources, quiz } = module.data;
---

<Layout title={title} description={description}>
  <div class="max-w-4xl mx-auto px-4 md:px-8 py-12">
    <nav class="mb-8">
      <a href="/ai-bootcamp-pages/course-2/" class="text-blue-600 hover:text-blue-800">&larr; Back to Course 2</a>
    </nav>

    <header class="mb-8">
      <span class="text-sm font-medium text-gray-500">Course 2 - Module {module.data.module}</span>
      <h1 class="text-3xl md:text-4xl font-bold text-[--propel-navy] mt-1 mb-4">{title}</h1>
      <p class="text-lg text-gray-600">{description}</p>
    </header>

    <ObjectivesList objectives={objectives} />

    <article class="prose mb-10">
      <Content />
    </article>

    {resources && resources.length > 0 && (
      <section class="mb-10">
        <h2 class="text-xl font-semibold text-[--propel-navy] mb-4">Resources</h2>
        <div class="space-y-3">
          {resources.map((resource) => (
            <ResourceLink title={resource.title} url={resource.url} type={resource.type} />
          ))}
        </div>
      </section>
    )}

    {quiz && quiz.length > 0 && (
      <section class="mb-10">
        <h2 class="text-xl font-semibold text-[--propel-navy] mb-4">Check Your Understanding</h2>
        <Quiz client:load questions={quiz} moduleId={`course-2-${module.slug}`} />
      </section>
    )}
  </div>
</Layout>
